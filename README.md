# Prediction Market

一个基于zkWasm的简单预测市场应用，专注于单个话题的预测。

## 功能特性

- **单一预测市场**: 专注于一个预测话题 - "比特币是否会在2024年底达到$100,000"
- **AMM算法**: 使用自动做市商算法进行价格发现和流动性管理
- **Yes/No投注**: 用户可以购买Yes或No份额
- **时间管理**: 设定市场开始、结束和解决时间
- **自动结算**: 市场解决后用户可以领取奖励

## 技术架构

### Rust后端 (src/)
- `lib.rs`: 应用入口点
- `config.rs`: 配置和常量定义
- `error.rs`: 错误代码定义
- `player.rs`: 玩家数据结构
- `market.rs`: 预测市场核心逻辑和AMM算法
- `state.rs`: 全局状态管理
- `transaction.rs`: 交易处理逻辑

### TypeScript服务端 (ts/)
- `src/service.ts`: 主服务文件，处理事件和API
- `src/models.ts`: 数据模型和MongoDB集成

## AMM算法

使用恒定乘积公式 (x * y = k) 进行自动做市：
- 初始流动性：Yes = 1,000,000, No = 1,000,000
- 价格计算：Yes价格 = No流动性 / (Yes流动性 + No流动性)
- 平台费用：0.25%

## API端点

- `GET /data/market` - 获取市场信息
- `GET /data/player/:pid1/:pid2` - 获取玩家信息
- `GET /data/bets` - 获取所有投注记录
- `GET /data/bets/:pid1/:pid2` - 获取特定玩家的投注记录
- `GET /data/stats` - 获取市场统计信息

## 交易命令

1. **下注** (命令1): `bet_type (0=NO, 1=YES), amount, pkey[4]`
2. **解决市场** (命令2): `outcome (0=NO, 1=YES), admin_pkey[4]` (仅管理员)
3. **领取奖励** (命令3): `pkey[4]`

## 构建和运行

```bash
# 构建项目
make build

# 运行服务
make run

# 清理
make clean
```

## 项目特点

- **简单易懂**: 专注于单一预测市场，代码结构清晰
- **易于维护**: 模块化设计，职责分离
- **完整功能**: 包含投注、AMM定价、市场解决和奖励领取
- **事件驱动**: 使用事件系统进行状态同步
- **数据持久化**: MongoDB存储历史数据和统计信息

## 市场生命周期

1. **活跃期**: 用户可以购买Yes/No份额
2. **结束期**: 停止接受新投注
3. **解决期**: 管理员设置最终结果
4. **领取期**: 获胜方用户领取奖励

市场解决后，应用完成其生命周期。 